<section id="bot">
    <div
        (click)="openChat()"
        class="bot-btn flex flex-column justify-content-center align-items-center"
    >
        <img
            src="/images/bot/bot.png"
            alt="bot image"
        />
        <app-main-button
            [fireStartExplore]="'bot'"
            [customClass]="'orange-btn'"
            [fontWeight]="'font-semibold'"
            [btnText]="(isActiveChat() ? 'bot.closeChat' : 'bot.openChat') | translate"
        />
    </div>
    <div
        class="chat-box"
        [class.active]="isActiveChat()"
    >
        <!-- Sidebar -->
        <div
            class="chat-sidebar"
            [class.hidden]="!isSidebarOpen()"
        >
            <div class="sidebar-header">
                <h4>{{ 'bot.previousConversations' | translate }}</h4>
            </div>

            <div class="conversations-list">
                @for (session of chatHistory(); track session.id) {
                <div
                    class="conversation-item"
                    (click)="loadSession(session.id); toggleSidebar()"
                >
                    <span class="conversation-text">
                        {{ session.title || ('bot.untitledChat' | translate) }}
                    </span>
                    <i
                        class="pi pi-trash delete-btn"
                        (click)="deleteSession(session.id); $event.stopPropagation()"
                    ></i>
                </div>
                } @empty {
                <p class="no-conversations">{{ 'bot.noPreviousConversations' | translate }}</p>
                }
            </div>
        </div>
        <div class="chat-nav flex justify-content-between align-items-center">
            <h3 class="my-0">{{ 'bot.smartCoach' | translate }}</h3>
            <i
                class="pi pi-align-right text-lg cursor-pointer"
                (click)="toggleSidebar()"
            ></i>
        </div>

        <!-- Overlay -->
        @if (isSidebarOpen()) {
        <div
            class="sidebar-overlay"
            (click)="toggleSidebar()"
        ></div>
        }

        <!-- Chat Messages Container -->
        <div
            class="chat-messages"
            #chatContainer
        >
            @for (msg of messages(); track $index) {
            <div
                class="message-bubble"
                [class.user]="msg.role === 'user'"
                [class.model]="msg.role === 'model'"
            >
                {{ msg.text }}
            </div>
            } @if (isStreaming()) {
            <div class="message-bubble model">
                <span class="loading-dots">●●●</span>
            </div>
            }@else { }
        </div>

        <div class="chat-input flex justify-content-between align-items-center">
            <div class="card relative flex justify-content-center">
                <input
                    type="text"
                    [placeholder]="'bot.placeholder' | translate"
                    [(ngModel)]="chatMessage"
                    (keydown.enter)="sendMessage()"
                />
                <i class="pi edit pi-pencil absolute"></i>
            </div>
            <div
                class="send-icon flex align-items-center"
                (click)="sendMessage()"
            >
                <i class="pi pi-send text-lg cursor-pointer"></i>
            </div>
        </div>
    </div>
</section>
